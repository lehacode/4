<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Manager System</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; }
    .done { text-decoration: line-through; color: gray; }
    .tab { margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Task Manager System</h1>

  <!-- Tabs -->
  <div class="tab">
    <button onclick="showView('manager')">Manager View</button>
    <button onclick="showView('employee')">Employee View</button>
  </div>

  <!-- Manager View -->
  <div id="managerView" style="display:none;">
    <h2>Manager Panel</h2>

    <h3>Manage Employees</h3>
    <input type="text" id="employeeName" placeholder="Employee name"/>
    <button onclick="addEmployee()">Add Employee</button>
    <ul id="employeeList"></ul>

    <h3>Add Task (Chung)</h3>
    <input type="text" id="taskInput" placeholder="Task name"/>
    <button onclick="addTask()">Add Task</button>

    <h3>All Tasks</h3>
    <ul id="allTaskList"></ul>
  </div>

  <!-- Employee View -->
  <div id="employeeView" style="display:none;">
    <h2>Employee Panel</h2>
    <label>Select Employee: </label>
    <select id="employeeSelector"></select>
    <h3>Tasks</h3>
    <ul id="myTaskList"></ul>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://task-manager-2025-ac725-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "task-manager-2025-ac725",
      storageBucket: "task-manager-2025-ac725.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Tab switcher
    function showView(view) {
      document.getElementById("managerView").style.display = (view === "manager") ? "block" : "none";
      document.getElementById("employeeView").style.display = (view === "employee") ? "block" : "none";
    }

    // ===== EMPLOYEES =====
    function addEmployee() {
      const name = document.getElementById("employeeName").value;
      if (name.trim()) {
        db.ref("employees").push({ name });
        document.getElementById("employeeName").value = "";
      }
    }

    function deleteEmployee(id) {
      db.ref("employees/" + id).remove();
    }

    function renderEmployees(employees) {
      const empList = document.getElementById("employeeList");
      const empSelector = document.getElementById("employeeSelector");
      empList.innerHTML = "";
      empSelector.innerHTML = "";

      for (let id in employees) {
        const emp = employees[id];

        // Manager list
        const li = document.createElement("li");
        li.innerText = emp.name;
        const delBtn = document.createElement("button");
        delBtn.innerText = "Delete";
        delBtn.onclick = () => deleteEmployee(id);
        li.appendChild(delBtn);
        empList.appendChild(li);

        // Employee dropdown
        const option = document.createElement("option");
        option.value = emp.name;
        option.innerText = emp.name;
        empSelector.appendChild(option);
      }
    }

    // Load employees real-time
    db.ref("employees").on("value", (snap) => {
      renderEmployees(snap.val() || {});
    });

    // ===== TASKS =====
    function addTask() {
      const name = document.getElementById("taskInput").value;
      if (name.trim()) {
        db.ref("tasks").push({ 
          name, 
          done: false, 
          completedBy: "", 
          completedAt: "" 
        });
        document.getElementById("taskInput").value = "";
      }
    }

    function deleteTask(id) {
      db.ref("tasks/" + id).remove();
    }

    function completeTask(id, empName) {
      const timestamp = new Date().toLocaleString();
      db.ref("tasks/" + id).update({
        done: true,
        completedBy: empName,
        completedAt: timestamp
      });
    }

    function renderAllTasks(tasks) {
      const list = document.getElementById("allTaskList");
      list.innerHTML = "";
      for (let id in tasks) {
        const t = tasks[id];
        const li = document.createElement("li");
        li.className = t.done ? "done" : "";
        li.innerHTML = `${t.name} 
          ${t.done ? `(Done by ${t.completedBy} at ${t.completedAt})` : ""}`;

        if (t.done) {
          const delBtn = document.createElement("button");
          delBtn.innerText = "Delete";
          delBtn.onclick = () => deleteTask(id);
          li.appendChild(delBtn);
        }

        list.appendChild(li);
      }
    }

    function renderEmployeeTasks(tasks, empName) {
      const list = document.getElementById("myTaskList");
      list.innerHTML = "";
      for (let id in tasks) {
        const t = tasks[id];
        const li = document.createElement("li");
        li.className = t.done ? "done" : "";
        li.innerHTML = `${t.name} 
          ${t.done ? `(Done by ${t.completedBy})` : ""}`;

        if (!t.done) {
          const btn = document.createElement("button");
          btn.innerText = "Mark Done";
          btn.onclick = () => completeTask(id, empName);
          li.appendChild(btn);
        }

        list.appendChild(li);
      }
    }

    db.ref("tasks").on("value", (snap) => {
      const tasks = snap.val() || {};
      renderAllTasks(tasks);

      const selectedEmp = document.getElementById("employeeSelector").value;
      if (selectedEmp) renderEmployeeTasks(tasks, selectedEmp);
    });

    document.getElementById("employeeSelector").addEventListener("change", () => {
      db.ref("tasks").once("value", (snap) => {
        const tasks = snap.val() || {};
        const selectedEmp = document.getElementById("employeeSelector").value;
        renderEmployeeTasks(tasks, selectedEmp);
      });
    });

    // ====== Khởi tạo mặc định nhân viên (chỉ chạy 1 lần) =====
    db.ref("employees").once("value", (snap) => {
      if (!snap.exists()) {
        ["Bác Oanh", "Bác Trang", "Bác Út", "Suri"].forEach(name => {
          db.ref("employees").push({ name });
        });
      }
    });
  </script>
</body>
</html>
