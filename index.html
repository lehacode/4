<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Manager System</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; }
    .done { text-decoration: line-through; color: gray; }
    .tab { margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Task Manager System</h1>

  <!-- Tabs -->
  <div class="tab">
    <button onclick="showView('manager')">Manager View</button>
    <button onclick="showView('employee')">Employee View</button>
  </div>

  <!-- Manager View -->
  <div id="managerView" style="display:none;">
    <h2>Manager Panel</h2>
    <h3>Add Employee</h3>
    <input type="text" id="employeeName" placeholder="Employee name"/>
    <input type="text" id="employeeRole" placeholder="Employee role"/>
    <button onclick="addEmployee()">Add Employee</button>
    <ul id="employeeList"></ul>

    <h3>Add Task</h3>
    <input type="text" id="taskInput" placeholder="Task name"/>
    <select id="assignEmployee"></select>
    <button onclick="addTask()">Assign Task</button>

    <h3>All Tasks</h3>
    <ul id="allTaskList"></ul>
  </div>

  <!-- Employee View -->
  <div id="employeeView" style="display:none;">
    <h2>Employee Panel</h2>
    <label>Select Employee: </label>
    <select id="employeeSelector" onchange="loadEmployeeTasks()"></select>
    <h3>My Tasks</h3>
    <ul id="myTaskList"></ul>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://task-manager-2025-ac725-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "task-manager-2025-ac725",
      storageBucket: "task-manager-2025-ac725.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Tab switcher
    function showView(view) {
      document.getElementById("managerView").style.display = (view === "manager") ? "block" : "none";
      document.getElementById("employeeView").style.display = (view === "employee") ? "block" : "none";
    }

    // ===== EMPLOYEES =====
    function addEmployee() {
      const name = document.getElementById("employeeName").value;
      const role = document.getElementById("employeeRole").value;
      if (name.trim() && role.trim()) {
        db.ref("employees").push({ name, role });
        document.getElementById("employeeName").value = "";
        document.getElementById("employeeRole").value = "";
      }
    }

    function renderEmployees(employees) {
      const employeeList = document.getElementById("employeeList");
      const assignSelect = document.getElementById("assignEmployee");
      const empSelector = document.getElementById("employeeSelector");
      employeeList.innerHTML = "";
      assignSelect.innerHTML = "";
      empSelector.innerHTML = "";

      for (let id in employees) {
        const emp = employees[id];
        // Manager list
        const li = document.createElement("li");
        li.innerText = `${emp.name} (${emp.role})`;
        employeeList.appendChild(li);

        // Assign task select
        const option1 = document.createElement("option");
        option1.value = id;
        option1.innerText = emp.name;
        assignSelect.appendChild(option1);

        // Employee view selector
        const option2 = document.createElement("option");
        option2.value = id;
        option2.innerText = emp.name;
        empSelector.appendChild(option2);
      }
    }

    db.ref("employees").on("value", (snap) => {
      renderEmployees(snap.val() || {});
    });

    // ===== TASKS =====
    function addTask() {
      const name = document.getElementById("taskInput").value;
      const employeeId = document.getElementById("assignEmployee").value;
      if (name.trim() && employeeId) {
        db.ref("tasks").push({ name, employeeId, done: false });
        document.getElementById("taskInput").value = "";
      }
    }

    function toggleTask(id, done) {
      db.ref("tasks/" + id).update({ done: !done });
    }

    function renderAllTasks(tasks, employees) {
      const list = document.getElementById("allTaskList");
      list.innerHTML = "";
      for (let id in tasks) {
        const t = tasks[id];
        const li = document.createElement("li");
        const empName = employees && employees[t.employeeId] ? employees[t.employeeId].name : "Unknown";
        li.innerHTML = `${t.name} â†’ ${empName} [${t.done ? "Done" : "Pending"}]`;
        list.appendChild(li);
      }
    }

    function renderEmployeeTasks(tasks, empId) {
      const list = document.getElementById("myTaskList");
      list.innerHTML = "";
      for (let id in tasks) {
        const t = tasks[id];
        if (t.employeeId === empId) {
          const li = document.createElement("li");
          li.className = t.done ? "done" : "";
          li.innerHTML = t.name;

          const btn = document.createElement("button");
          btn.innerText = t.done ? "Undo" : "Mark Done";
          btn.onclick = () => toggleTask(id, t.done);

          li.appendChild(btn);
          list.appendChild(li);
        }
      }
    }

    let employeesCache = {};
    db.ref("employees").on("value", (snap) => {
      employeesCache = snap.val() || {};
    });

    db.ref("tasks").on("value", (snap) => {
      const tasks = snap.val() || {};
      renderAllTasks(tasks, employeesCache);

      const selectedEmp = document.getElementById("employeeSelector").value;
      if (selectedEmp) renderEmployeeTasks(tasks, selectedEmp);
    });

    function loadEmployeeTasks() {
      db.ref("tasks").once("value", (snap) => {
        const tasks = snap.val() || {};
        const selectedEmp = document.getElementById("employeeSelector").value;
        renderEmployeeTasks(tasks, selectedEmp);
      });
    }
  </script>
</body>
</html>
