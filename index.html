<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìã H·ªá th·ªëng Qu·∫£n l√Ω C√¥ng vi·ªác</title>

  <!-- Firebase SDK -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      min-height: 100vh;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .employee-management {
      background: #e7f3ff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px dashed #007bff;
    }
    .employee-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }
    .employee-tag {
      background: #28a745;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .add-employee-form {
      display: flex;
      gap: 10px;
    }
    .add-employee-form input {
      flex: 1;
      padding: 8px 12px;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .add-employee-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .add-employee-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    .employee-select {
      margin-top: 20px;
    }
    .employee-select label {
      font-weight: bold;
    }
    .employee-select select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìã Qu·∫£n l√Ω C√¥ng vi·ªác</h1>

    <div class="employee-management">
      <h3>üë• Qu·∫£n l√Ω Nh√¢n vi√™n</h3>
      <div class="employee-list" id="employeeList"></div>
      <div class="add-employee-form">
        <input type="text" id="newEmployeeName" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n m·ªõi..." maxlength="30" />
        <button class="add-employee-btn" id="addEmployeeBtn">‚ûï Th√™m</button>
      </div>
    </div>

    <div class="employee-select">
      <label for="employeeName">üë§ Ch·ªçn t√™n c·ªßa b·∫°n:</label>
      <select id="employeeName">
        <option value="">-- Ch·ªçn t√™n --</option>
      </select>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyABkEBU-WfsmAKYbbQzFL1rVl1FhYmyJEU",
      authDomain: "task-manager-2025-ac725.firebaseapp.com",
      databaseURL: "https://task-manager-2025-ac725-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "task-manager-2025-ac725",
      storageBucket: "task-manager-2025-ac725.firebasestorage.app",
      messagingSenderId: "971332334564",
      appId: "1:971332334564:web:9edbb1d56068f021bb8df1"
    };

    let database = null;
    let employees = [];
    let isOnline = false;

    class TaskManager {
      constructor() {
        this.initializeApp();
        this.setupEventListeners();
      }

      async initializeApp() {
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        database = firebase.database();

        const testRef = database.ref('.info/connected');
        testRef.on('value', (snapshot) => {
          if (snapshot.val() === true) {
            isOnline = true;
            this.loadEmployeesFromFirebase();
          } else {
            isOnline = false;
            this.loadEmployeesFromLocalStorage();
          }
        });
      }

      setupEventListeners() {
        document.getElementById('addEmployeeBtn').addEventListener('click', () => this.addEmployee());
        document.getElementById('newEmployeeName').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.addEmployee();
        });
      }

      addEmployee() {
        const nameInput = document.getElementById('newEmployeeName');
        const newName = nameInput.value.trim();

        if (!newName) {
          alert('Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n!');
          return;
        }
        if (employees.includes(newName)) {
          alert('T√™n n√†y ƒë√£ t·ªìn t·∫°i!');
          return;
        }

        const btn = document.getElementById('addEmployeeBtn');
        btn.disabled = true;
        btn.textContent = 'ƒêang th√™m...';

        employees.push(newName);
        this.saveEmployeesToFirebase();

        // C·∫≠p nh·∫≠t UI ngay
        this.updateEmployeeList();
        this.updateEmployeeDropdowns();

        nameInput.value = '';
        btn.disabled = false;
        btn.textContent = '‚ûï Th√™m';

        console.log(`üë§ ƒê√£ th√™m nh√¢n vi√™n: ${newName}`);
      }

      saveEmployeesToFirebase() {
        if (!isOnline || !database) {
          this.saveEmployeesToLocalStorage();
          return;
        }
        const employeesRef = database.ref('employees');
        const employeesObj = {};
        employees.forEach((emp, i) => {
          employeesObj[`employee_${i}`] = emp;
        });
        employeesRef.set(employeesObj).then(() => this.saveEmployeesToLocalStorage());
      }

      saveEmployeesToLocalStorage() {
        localStorage.setItem('taskManagementEmployees', JSON.stringify(employees));
      }

      loadEmployeesFromFirebase() {
        const employeesRef = database.ref('employees');
        employeesRef.on('value', (snapshot) => {
          const data = snapshot.val();
          employees = data ? Object.values(data) : [];
          this.updateEmployeeDropdowns();
          this.updateEmployeeList();
        });
      }

      loadEmployeesFromLocalStorage() {
        const saved = localStorage.getItem('taskManagementEmployees');
        employees = saved ? JSON.parse(saved) : [];
        this.updateEmployeeDropdowns();
        this.updateEmployeeList();
      }

      updateEmployeeDropdowns() {
        const employeeNameSelect = document.getElementById('employeeName');
        if (!employeeNameSelect) return;
        employeeNameSelect.innerHTML = '<option value="">-- Ch·ªçn t√™n --</option>';
        employees.forEach(emp => {
          const option = document.createElement('option');
          option.value = emp;
          option.textContent = emp;
          employeeNameSelect.appendChild(option);
        });
      }

      updateEmployeeList() {
        const employeeListElement = document.getElementById('employeeList');
        if (!employeeListElement) return;
        employeeListElement.innerHTML = employees.map(emp => `
          <div class="employee-tag">
            <span>üë§ ${emp}</span>
          </div>
        `).join('');
      }
    }

    let taskManager;
    document.addEventListener('DOMContentLoaded', () => {
      taskManager = new TaskManager();
    });
  </script>
</body>
</html>
